<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Lynka â€” Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#eef5ff;            /* Ø®Ù„ÙÙŠØ© Ø¹Ø§Ù…Ø© ÙØ§ØªØ­Ø© Ø¬Ø¯Ù‹Ø§ */
      --card:#ffffff;          /* Ø¨Ø·Ø§Ù‚Ø§Øª */
      --ink:#0b1220;           /* Ù†Øµ ØºØ§Ù…Ù‚ */
      --muted:#6b7280;         /* Ù†Øµ Ø«Ø§Ù†ÙˆÙŠ */
      --brand:#2563eb;         /* Ø£Ø²Ø±Ù‚ Ø£Ø³Ø§Ø³ÙŠ */
      --ok:#10b981;            /* Ø£Ø®Ø¶Ø± */
      --danger:#ef4444;        /* Ø£Ø­Ù…Ø± */
      --tabbar:#171a1f;        /* Ø´Ø±ÙŠØ· ØªØ¨ÙˆÙŠØ¨ Ø£Ø³ÙˆØ¯ */
      --soft-blue:#edf4ff;     /* Ø®Ù„ÙÙŠØ© ÙØ§ØªØ­Ø© Ù„Ù„Ø£Ù‚Ø³Ø§Ù… */
      --soft-green:#ecfff2;    /* Ø£Ø®Ø¶Ø± ÙØ§ØªØ­ */
      --soft-task:#f0f6ff;     /* Ø£Ø²Ø±Ù‚ ÙØ§ØªØ­ Ù„Ù„Ù…Ù‡Ø§Ù… ØºÙŠØ± Ø§Ù„Ù…Ù†Ø¬Ø²Ø© */
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--ink);font-family:"Cairo",system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial}
    .wrap{max-width:1000px;margin:auto;padding:16px 14px 40px}

    /* Header */
    .topbar{
      display:flex;align-items:center;justify-content:space-between;
      gap:12px;margin-bottom:12px
    }
    .title{font-weight:800;font-size:22px}
    .user-pill{
      display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:12px;
      background:linear-gradient(135deg,#4f46e5,#06b6d4);color:#fff;font-weight:700
    }

    /* NAV TABS */
    .nav-tabs{
      display:flex; gap:6px; background:var(--tabbar);
      padding:6px; border-radius:12px; position:sticky; top:10px; z-index:20;
      box-shadow:0 6px 24px rgba(0,0,0,.12), inset 0 0 0 1px #222831
    }
    .nav-tab{
      flex:1; border:0; cursor:pointer; padding:12px 14px; border-radius:10px;
      background:transparent; color:#f1f5f9; font-weight:800; font-size:14px; letter-spacing:.1px;
      display:flex; align-items:center; justify-content:center; gap:10px;
      transition:background .18s ease, color .18s ease, transform .12s ease;
      user-select:none
    }
    .nav-tab:hover{ background:rgba(255,255,255,.08) }
    .nav-tab:active{ transform:translateY(1px) }
    .nav-tab.active{ background:#f6f7fb; color:var(--ink); box-shadow: inset 0 0 0 2px #e6e9f2 }

    /* Sections */
    section{background:var(--soft-blue); margin-top:12px; padding:16px; border-radius:14px;
      box-shadow: 0 6px 24px rgba(15,23,42,.06), inset 0 0 0 1px rgba(15,23,42,.06)}
    section.greenish{ background: #f5fff8 }
    .hide{display:none !important}

    /* Cards + inputs */
    .card{background:var(--card); border-radius:14px; padding:14px; box-shadow:0 1px 0 rgba(2,6,23,.06)}
    .grid{display:grid; gap:12px}
    .grid.two{grid-template-columns:1fr 1fr}
    .grid.three{grid-template-columns:1fr 1fr 1fr}
    @media(max-width:700px){ .grid.two, .grid.three{grid-template-columns:1fr} }

    label{font-size:13px;color:var(--muted)}
    input, select{
      width:100%; padding:12px 10px; border-radius:10px; border:1px solid #e5e7eb; background:#fff;
      font-size:14px; outline:none
    }
    input::placeholder{color:#94a3b8}
    .btn{
      border:0; border-radius:10px; padding:10px 14px; font-weight:800; cursor:pointer
    }
    .btn.brand{ background:var(--brand); color:#fff }
    .btn.ok{ background:var(--ok); color:#032313 }
    .btn.red{ background:var(--danger); color:#fff }
    .btn.ghost{ background:#eef2ff; color:#1e293b }

    .list{display:flex;flex-direction:column;gap:10px}
    .task{
      display:flex; gap:10px; align-items:flex-start; background:var(--soft-task); padding:12px; border-radius:12px
    }
    .task .txt{flex:1; line-height:1.8}
    .task small{color:var(--muted)}
    .task-done{ background:var(--soft-green) }

    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .price-row,.order-row,.ledger-row,.client-row,.stock-row{
      display:grid; grid-template-columns:2fr 1fr auto; gap:8px; align-items:center
    }
    .ledger-row{ grid-template-columns:2fr 1fr 1fr auto }
    .client-row{ grid-template-columns:2fr 1fr auto }
    .stock-row{ grid-template-columns:2fr 1fr 1fr auto }

    .sum{font-weight:800}
    .muted{color:var(--muted)}
    .big{font-size:18px;font-weight:800}

    /* Auth card */
    .auth{max-width:520px;margin:40px auto}
    .toast{
      position:fixed; inset-inline:0; top:14px; margin:auto; max-width:520px;
      background:#0f172a; color:#fff; padding:12px 14px; border-radius:12px;
      display:flex; justify-content:center; align-items:center; gap:10px;
      transform:translateY(-30px); opacity:0; pointer-events:none;
      transition:all .35s ease; z-index:9999
    }
    .toast.show{ transform:translateY(0); opacity:1 }
  </style>
</head>
<body>

<div class="wrap">

  <div class="topbar">
    <div class="title">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© â€” <b>Lynka</b></div>
    <div class="user-pill" id="userPill" title="Ø§Ù„Ø­Ø³Ø§Ø¨">
      <span id="userEmail">ØºÙŠØ± Ù…Ø³Ø¬Ù„</span>
    </div>
  </div>

  <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª -->
  <div class="nav-tabs" id="navTabs">
    <button class="nav-tab active" data-s="tasks">ğŸ“ Ø§Ù„Ù…Ù‡Ø§Ù…</button>
    <button class="nav-tab" data-s="prices">ğŸ·ï¸ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±</button>
    <button class="nav-tab" data-s="orders">ğŸ§¾ Ø§Ù„Ø£ÙˆØ±Ø¯Ø±Ø§Øª</button>
    <button class="nav-tab" data-s="finance">ğŸ’¹ Ù…ØµØ±ÙˆÙØ§Øª ÙˆØ£Ø±Ø¨Ø§Ø­</button>
    <button class="nav-tab" data-s="clients">ğŸ‘¥ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</button>
    <button class="nav-tab" data-s="inventory">ğŸ“¦ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</button>
  </div>

  <!-- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
  <section id="s-auth" class="auth">
    <div class="card grid">
      <h2 style="margin:0 0 6px">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Lynka</h2>
      <div class="grid two">
        <div>
          <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
          <input id="inEmail" type="email" placeholder="example@lynka.com" inputmode="email">
        </div>
        <div>
          <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
          <input id="inPass" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="current-password">
        </div>
      </div>
      <div class="row">
        <button class="btn brand" id="btnLogin">Ø¯Ø®ÙˆÙ„</button>
        <div class="muted">Ø§Ø³ØªØ®Ø¯Ù…: <b>1@lynka.com</b> Ø£Ùˆ <b>2@lynka.com</b> ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±: <b>87654321</b></div>
      </div>
      <div id="authErr" class="muted"></div>
    </div>
  </section>

  <!-- Ø§Ù„Ù…Ù‡Ø§Ù… -->
  <section id="s-tasks">
    <div class="grid two">
      <div class="card">
        <h3 style="margin-top:0">Ø£Ø¶Ù Ù…Ù‡Ù…Ø©</h3>
        <div class="grid">
          <input id="taskText" placeholder="Ø§ÙƒØªØ¨ Ù…Ù‡Ù…Ø© ÙˆØ§Ø­Ø¯Ø© (Ø§Ù„Ø³Ø·Ø± Ø·ÙˆÙŠÙ„ ÙˆÙ…ÙØªÙˆØ­)">
          <input id="taskTag" placeholder="Ø§Ù„ØªØµÙ†ÙŠÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
          <div class="row">
            <button class="btn brand" id="addTask">Ø¥Ø¶Ø§ÙØ©</button>
            <button class="btn ghost" id="clearSel">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ¯</button>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="row" style="justify-content:space-between">
          <h3 style="margin:0">Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…Ù†Ø¬Ø²Ø©</h3>
          <div class="muted">Ø¹Ø¯Ø¯: <span id="doneCount">0</span></div>
        </div>
        <div class="list" id="doneList"></div>
      </div>
    </div>

    <div class="card" style="margin-top:12px">
      <div class="row" style="justify-content:space-between">
        <h3 style="margin:0">Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù†Ø´Ø·Ø©</h3>
        <div class="muted">Ø¹Ø¯Ø¯: <span id="activeCount">0</span></div>
      </div>
      <div class="list" id="taskList"></div>
    </div>
  </section>

  <!-- Ø§Ù„Ø£Ø³Ø¹Ø§Ø± -->
  <section id="s-prices" class="hide">
    <div class="card grid">
      <h3 style="margin:0">Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</h3>
      <div class="price-row">
        <input id="pName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
        <input id="pPrice" placeholder="Ø§Ù„Ø³Ø¹Ø±" inputmode="decimal">
        <button class="btn brand" id="addPrice">Ø¥Ø¶Ø§ÙØ©</button>
      </div>
    </div>
    <div class="card" style="margin-top:12px">
      <div class="row" style="justify-content:space-between">
        <h3 style="margin:0">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ø¹Ø§Ø±</h3>
        <div class="sum">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="sumPrices">0</span></div>
      </div>
      <div id="priceList" class="list"></div>
    </div>
  </section>

  <!-- Ø§Ù„Ø£ÙˆØ±Ø¯Ø±Ø§Øª -->
  <section id="s-orders" class="hide">
    <div class="card grid">
      <h3 style="margin:0">Ø¥Ø¶Ø§ÙØ© Ø£ÙˆØ±Ø¯Ø±</h3>
      <div class="order-row">
        <input id="oClient" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„">
        <input id="oAmount" placeholder="Ø§Ù„Ù‚ÙŠÙ…Ø©" inputmode="decimal">
        <button class="btn brand" id="addOrder">Ø¥Ø¶Ø§ÙØ©</button>
      </div>
    </div>
    <div class="card" style="margin-top:12px">
      <div class="row" style="justify-content:space-between">
        <h3 style="margin:0">Ø§Ù„Ø£ÙˆØ±Ø¯Ø±Ø§Øª</h3>
        <div class="sum">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="sumOrders">0</span></div>
      </div>
      <div id="orderList" class="list"></div>
    </div>
  </section>

  <!-- Ù…ØµØ±ÙˆÙØ§Øª ÙˆØ£Ø±Ø¨Ø§Ø­ -->
  <section id="s-finance" class="hide greenish">
    <div class="grid two">
      <div class="card">
        <h3 style="margin:0">Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</h3>
        <div class="ledger-row">
          <input id="exDesc" placeholder="ÙˆØµÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
          <input id="exAmount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº" inputmode="decimal">
          <button class="btn red" id="addExpense">Ø¥Ø¶Ø§ÙØ©</button>
        </div>
        <div id="expList" class="list" style="margin-top:10px"></div>
        <div class="row" style="justify-content:space-between;margin-top:10px">
          <div class="sum">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª: <span id="sumExp">0</span></div>
        </div>
      </div>

      <div class="card">
        <h3 style="margin:0">Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</h3>
        <div class="ledger-row">
          <input id="prDesc" placeholder="ÙˆØµÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
          <input id="prAmount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº" inputmode="decimal">
          <button class="btn ok" id="addProfit">Ø¥Ø¶Ø§ÙØ©</button>
        </div>
        <div id="proList" class="list" style="margin-top:10px"></div>
        <div class="row" style="justify-content:space-between;margin-top:10px">
          <div class="sum">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­: <span id="sumPro">0</span></div>
        </div>
      </div>
    </div>
  </section>

  <!-- Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ -->
  <section id="s-clients" class="hide">
    <div class="card grid">
      <h3 style="margin:0">Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„</h3>
      <div class="client-row">
        <input id="cName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„">
        <input id="cPhone" placeholder="Ù‡Ø§ØªÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" inputmode="tel">
        <button class="btn brand" id="addClient">Ø¥Ø¶Ø§ÙØ©</button>
      </div>
    </div>
    <div class="card" style="margin-top:12px">
      <h3 style="margin:0">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h3>
      <div id="clientList" class="list" style="margin-top:8px"></div>
    </div>
  </section>

  <!-- Ø§Ù„Ù…Ø®Ø²ÙˆÙ† -->
  <section id="s-inventory" class="hide">
    <div class="card grid">
      <h3 style="margin:0">Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù Ù…Ø®Ø²ÙˆÙ†</h3>
      <div class="stock-row">
        <input id="sItem" placeholder="Ø§Ù„ØµÙ†Ù">
        <input id="sQty" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©" inputmode="numeric">
        <input id="sCat" placeholder="Ø§Ù„ØªØµÙ†ÙŠÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
        <button class="btn brand" id="addStock">Ø¥Ø¶Ø§ÙØ©</button>
      </div>
    </div>
    <div class="card" style="margin-top:12px">
      <h3 style="margin:0">Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</h3>
      <div id="stockList" class="list" style="margin-top:8px"></div>
    </div>
  </section>

</div>

<!-- Toast ØªØ±Ø­ÙŠØ¨ -->
<div id="welcomeToast" class="toast">ğŸ‘‹ Welcome <b>Steven</b> and <b>Nassef</b></div>

<!-- Firebase SDKs (v12) -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
  import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";
  import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, doc, deleteDoc, updateDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

  /* ====== Firebase config (Ø¨Ø¯Ù‘Ù„Ù‡Ø§ Ù„Ùˆ ØªØºÙŠÙ‘Ø±Øª Ù…Ù† Ù„ÙˆØ­Ø© Firebase) ====== */
  const firebaseConfig = {
    apiKey: "AIzaSyCnM6-7BoICLWAXUeH8qz8A_OCiCGpQtMU",
    authDomain: "lynka-to-do-list-eb2ac.firebaseapp.com",
    projectId: "lynka-to-do-list-eb2ac",
    storageBucket: "lynka-to-do-list-eb2ac.firebasestorage.app",
    messagingSenderId: "202285237255",
    appId: "1:202285237255:web:c12e66369d033e4ecd96a2"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db   = getFirestore(app);

  /* ====== UI helpers ====== */
  const $ = s => document.querySelector(s);
  const $$ = s => document.querySelectorAll(s);

  const sections = $$('section[id^="s-"]');
  const tabs = $$('.nav-tab');

  function showSection(key){
    tabs.forEach(t => t.classList.toggle('active', t.dataset.s === key));
    sections.forEach(s => s.classList.toggle('hide', s.id !== 's-'+key));
    sessionStorage.setItem('lynka_tab', key);
  }

  tabs.forEach(t => t.addEventListener('click', () => showSection(t.dataset.s)));

  /* ====== Welcome toast: Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© Ø«Ø§Ù†ÙŠØ© ÙˆØ§Ø­Ø¯Ø© ====== */
  const toast = $('#welcomeToast');
  if (!localStorage.getItem('lynka_welcomed')){
    requestAnimationFrame(()=>{
      toast.classList.add('show');
      setTimeout(()=> toast.classList.remove('show'), 1000);
      setTimeout(()=> toast.remove(), 1600);
      localStorage.setItem('lynka_welcomed','1');
    });
  } else {
    toast.remove();
  }

  /* ====== Auth ====== */
  const sAuth = $('#s-auth');
  const userPill = $('#userPill'); const userEmail = $('#userEmail');

  $('#btnLogin').addEventListener('click', async ()=>{
    const email = $('#inEmail').value.trim();
    const pass  = $('#inPass').value.trim();
    $('#authErr').textContent = '';
    try{
      await signInWithEmailAndPassword(auth, email, pass);
    }catch(e){
      $('#authErr').textContent = 'Ø®Ø·Ø£: ' + (e.code || e.message);
    }
  });

  userPill.addEventListener('click', async ()=>{
    if (auth.currentUser){ await signOut(auth); }
  });

  onAuthStateChanged(auth, (u)=>{
    if(u){
      sAuth.classList.add('hide');
      document.body.classList.remove('locked');
      userEmail.textContent = u.email;
      showSection(sessionStorage.getItem('lynka_tab') || 'tasks');
    }else{
      sAuth.classList.remove('hide');
      userEmail.textContent = 'ØºÙŠØ± Ù…Ø³Ø¬Ù„';
      showSection('tasks'); // Ø®Ù„ÙÙŠØ© ÙÙ‚Ø·
    }
  });

  /* ====== Collections ====== */
  const colTasks   = collection(db, 'lynka_tasks');
  const colPrices  = collection(db, 'lynka_prices');
  const colOrders  = collection(db, 'lynka_orders');
  const colExp     = collection(db, 'lynka_expenses');
  const colPro     = collection(db, 'lynka_profits');
  const colClients = collection(db, 'lynka_clients');
  const colStock   = collection(db, 'lynka_stock');

  /* ====== Tasks ====== */
  $('#addTask').addEventListener('click', async ()=>{
    const text = $('#taskText').value.trim();
    const tag  = $('#taskTag').value.trim();
    if(!text) return;
    await addDoc(colTasks, { text, tag: tag || null, done:false, createdAt: serverTimestamp() });
    $('#taskText').value=''; $('#taskTag').value='';
  });

  function taskItem(id, data){
    const el = document.createElement('div');
    el.className = 'task' + (data.done ? ' task-done':'');
    el.innerHTML = `
      <div style="padding-top:2px"><input type="checkbox" ${data.done?'checked':''}></div>
      <div class="txt">
        <div>${escapeHtml(data.text)}</div>
        <small>${data.tag?`Ø§Ù„ØªØµÙ†ÙŠÙ: ${escapeHtml(data.tag)} â€” `:''}${data.createdAt?.toDate? new Date(data.createdAt.toDate()).toLocaleString() : ''}</small>
      </div>
      <button class="btn red">Ø­Ø°Ù</button>
    `;
    const chk = el.querySelector('input[type=checkbox]');
    const del = el.querySelector('.btn.red');
    chk.addEventListener('change', async ()=>{ await updateDoc(doc(db,'lynka_tasks',id), { done: chk.checked }); });
    del.addEventListener('click', async ()=>{ await deleteDoc(doc(db,'lynka_tasks',id)); });
    return el;
  }

  function renderTasks(list){
    const active = list.filter(x=>!x.data.done);
    const done   = list.filter(x=> x.data.done);
    $('#activeCount').textContent = active.length;
    $('#doneCount').textContent   = done.length;
    const taskList = $('#taskList'); taskList.innerHTML='';
    const doneList = $('#doneList'); doneList.innerHTML='';
    active.forEach(x => taskList.appendChild(taskItem(x.id,x.data)));
    done.forEach(x   => doneList.appendChild(taskItem(x.id,x.data)));
  }

  onSnapshot(query(colTasks, orderBy('createdAt','desc')), (snap)=>{
    const arr=[]; snap.forEach(d=>arr.push({id:d.id, data:d.data()})); renderTasks(arr);
  });

  $('#clearSel').addEventListener('click', ()=>{
    // Ù„Ø§ Ù†Ø³ØªØ®Ø¯Ù… ØªØ­Ø¯ÙŠØ¯ Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ø¢Ù† â€” Ø²Ø± Ù„Ù„Ø§Ø­ØªÙŠØ§Ø·
  });

  /* ====== Prices ====== */
  $('#addPrice').addEventListener('click', async ()=>{
    const name = $('#pName').value.trim();
    const price = parseFloat(($('#pPrice').value||'').toString().replace(',','.'));
    if(!name || isNaN(price)) return;
    await addDoc(colPrices, { name, price, createdAt: serverTimestamp() });
    $('#pName').value=''; $('#pPrice').value='';
  });

  onSnapshot(query(colPrices, orderBy('createdAt','desc')), (snap)=>{
    const list = $('#priceList'); list.innerHTML='';
    let sum=0;
    snap.forEach(d=>{
      const {name,price}=d.data(); sum+=Number(price)||0;
      const row = document.createElement('div'); row.className='card row'; 
      row.innerHTML = `
        <div class="big">${escapeHtml(name)}</div>
        <div class="big">${Number(price).toLocaleString('en-US')}</div>
        <button class="btn red">Ø­Ø°Ù</button>`;
      row.querySelector('.btn.red').addEventListener('click', ()=> deleteDoc(doc(db,'lynka_prices',d.id)));
      list.appendChild(row);
    });
    $('#sumPrices').textContent = sum.toLocaleString('en-US');
  });

  /* ====== Orders ====== */
  $('#addOrder').addEventListener('click', async ()=>{
    const client = $('#oClient').value.trim();
    const amount = parseFloat(($('#oAmount').value||'').toString().replace(',','.'));
    if(!client || isNaN(amount)) return;
    await addDoc(colOrders, { client, amount, createdAt: serverTimestamp() });
    $('#oClient').value=''; $('#oAmount').value='';
  });

  onSnapshot(query(colOrders, orderBy('createdAt','desc')), (snap)=>{
    const list = $('#orderList'); list.innerHTML='';
    let sum=0;
    snap.forEach(d=>{
      const {client,amount}=d.data(); sum+=Number(amount)||0;
      const row = document.createElement('div'); row.className='card row';
      row.innerHTML = `
        <div>${escapeHtml(client)}</div>
        <div class="big">${Number(amount).toLocaleString('en-US')}</div>
        <button class="btn red">Ø­Ø°Ù</button>`;
      row.querySelector('.btn.red').addEventListener('click', ()=> deleteDoc(doc(db,'lynka_orders',d.id)));
      list.appendChild(row);
    });
    $('#sumOrders').textContent = sum.toLocaleString('en-US');
  });

  /* ====== Finance (Expenses & Profits) ====== */
  $('#addExpense').addEventListener('click', async ()=>{
    const desc = $('#exDesc').value.trim() || null;
    const amount = parseFloat(($('#exAmount').value||'').toString().replace(',','.'));
    if(isNaN(amount)) return;
    await addDoc(colExp, { desc, amount, createdAt: serverTimestamp() });
    $('#exDesc').value=''; $('#exAmount').value='';
  });
  $('#addProfit').addEventListener('click', async ()=>{
    const desc = $('#prDesc').value.trim() || null;
    const amount = parseFloat(($('#prAmount').value||'').toString().replace(',','.'));
    if(isNaN(amount)) return;
    await addDoc(colPro, { desc, amount, createdAt: serverTimestamp() });
    $('#prDesc').value=''; $('#prAmount').value='';
  });

  onSnapshot(query(colExp, orderBy('createdAt','desc')), (snap)=>{
    const list = $('#expList'); list.innerHTML=''; let sum=0;
    snap.forEach(d=>{
      const {desc,amount}=d.data(); sum+=Number(amount)||0;
      const row = document.createElement('div'); row.className='card row';
      row.innerHTML = `<div>${desc?escapeHtml(desc):'<span class="muted">Ø¨Ø¯ÙˆÙ† ÙˆØµÙ</span>'}</div>
                       <div class="big">${Number(amount).toLocaleString('en-US')}</div>
                       <button class="btn red">Ø­Ø°Ù</button>`;
      row.querySelector('.btn.red').addEventListener('click', ()=> deleteDoc(doc(db,'lynka_expenses',d.id)));
      list.appendChild(row);
    });
    $('#sumExp').textContent = sum.toLocaleString('en-US');
  });

  onSnapshot(query(colPro, orderBy('createdAt','desc')), (snap)=>{
    const list = $('#proList'); list.innerHTML=''; let sum=0;
    snap.forEach(d=>{
      const {desc,amount}=d.data(); sum+=Number(amount)||0;
      const row = document.createElement('div'); row.className='card row';
      row.innerHTML = `<div>${desc?escapeHtml(desc):'<span class="muted">Ø¨Ø¯ÙˆÙ† ÙˆØµÙ</span>'}</div>
                       <div class="big">${Number(amount).toLocaleString('en-US')}</div>
                       <button class="btn red">Ø­Ø°Ù</button>`;
      row.querySelector('.btn.red').addEventListener('click', ()=> deleteDoc(doc(db,'lynka_profits',d.id)));
      list.appendChild(row);
    });
    $('#sumPro').textContent = sum.toLocaleString('en-US');
  });

  /* ====== Clients ====== */
  $('#addClient').addEventListener('click', async ()=>{
    const name = $('#cName').value.trim();
    const phone= $('#cPhone').value.trim() || null;
    if(!name) return;
    await addDoc(colClients, { name, phone, createdAt: serverTimestamp() });
    $('#cName').value=''; $('#cPhone').value='';
  });

  onSnapshot(query(colClients, orderBy('createdAt','desc')), (snap)=>{
    const list = $('#clientList'); list.innerHTML='';
    snap.forEach(d=>{
      const {name,phone}=d.data();
      const row = document.createElement('div'); row.className='card row';
      row.innerHTML = `<div class="big">${escapeHtml(name)}</div>
                       <div>${phone?escapeHtml(phone):'<span class="muted">â€”</span>'}</div>
                       <button class="btn red">Ø­Ø°Ù</button>`;
      row.querySelector('.btn.red').addEventListener('click', ()=> deleteDoc(doc(db,'lynka_clients',d.id)));
      list.appendChild(row);
    });
  });

  /* ====== Inventory ====== */
  $('#addStock').addEventListener('click', async ()=>{
    const item = $('#sItem').value.trim();
    const qty  = parseInt($('#sQty').value||'0',10);
    const cat  = $('#sCat').value.trim() || null;
    if(!item || !qty) return;
    await addDoc(colStock, { item, qty, cat, createdAt: serverTimestamp() });
    $('#sItem').value=''; $('#sQty').value=''; $('#sCat').value='';
  });

  onSnapshot(query(colStock, orderBy('createdAt','desc')), (snap)=>{
    const list = $('#stockList'); list.innerHTML='';
    snap.forEach(d=>{
      const {item,qty,cat}=d.data();
      const row = document.createElement('div'); row.className='card row';
      row.innerHTML = `<div class="big">${escapeHtml(item)} ${cat?`<span class="muted">(${escapeHtml(cat)})</span>`:''}</div>
                       <div class="big">${Number(qty).toLocaleString('en-US')}</div>
                       <button class="btn red">Ø­Ø°Ù</button>`;
      row.querySelector('.btn.red').addEventListener('click', ()=> deleteDoc(doc(db,'lynka_stock',d.id)));
      list.appendChild(row);
    });
  });

  function escapeHtml(s){ return String(s).replace(/[&<>"']/g,m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#039;" }[m])) }

  // Ø¹Ù†Ø¯ Ø£ÙˆÙ„ ØªØ­Ù…ÙŠÙ„ØŒ Ø§Ø¹Ø±Ø¶ Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ù…Ù† Ø§Ù„Ø¬Ù„Ø³Ø© Ø£Ùˆ Ø§Ù„Ù…Ù‡Ø§Ù…
  showSection(sessionStorage.getItem('lynka_tab') || 'tasks');
</script>
</body>
</html>
